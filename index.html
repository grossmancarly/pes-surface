<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive PES Surface</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h2>Interactive PES Surface</h2>
    <div id="plot"></div>
    <div id="contour"></div>
    
    <label for="Ea">Activation Energy (Ea):</label>
    <input type="range" id="Ea" min="0.1" max="5.0" step="0.1" value="2.5" oninput="updatePlot()">
    
    <label for="transition">Early/Late Transition State:</label>
    <input type="range" id="transition" min="-1.0" max="2.0" step="0.1" value="0.5" oninput="updatePlot()">
    
    <script>
        function generateSurface(Ea, transition) {
            let x = numeric.linspace(0.1, 5, 100); // Ensure x > 0
            let y = numeric.linspace(0.1, 5, 100); // Ensure y > 0
            let Z = [];

            // Parameter values
            let alpha = Ea;
            let beta = -0.07;
            let A = 1.73;
            let B = 3.03;
            let xs = -0.36; // Keep xs constant
            let gamma = 0.7;
            let delta = 1.0;

            // Adjust (s, q) to stay on the reaction path
            let s = transition;
            let q = A / (B + (s - xs)); // Ensures (s, q) stays on the reaction path

            for (let i = 0; i < y.length; i++) {
                let row = [];
                for (let j = 0; j < x.length; j++) {
                    let X = x[j];
                    let Y = y[i];

                    // Reaction path equation (maintains elbow shape)
                    let reactionPath = A / (B + ((X - s) - xs)) + q;

                    // Energy function ensuring saddle point at (s, q)
                    let raw_Z = alpha * (X - s) ** 2 + beta * (X - s) ** 4 + gamma * ((Y - q) - reactionPath) ** 2;

                    // Normalized energy for better visualization
                    row.push(raw_Z / Math.sqrt(1 + delta * raw_Z ** 2));
                }
                Z.push(row);
            }

            return { x: x, y: y, z: Z };
        }

        function updatePlot() {
            let Ea = parseFloat(document.getElementById('Ea').value);
            let transition = parseFloat(document.getElementById('transition').value);
            
            let surfaceData = generateSurface(Ea, transition);
            let surfacePlot = [{ type: 'surface', x: surfaceData.x, y: surfaceData.y, z: surfaceData.z, colorscale: 'Jet' }];
            let contourPlot = [{ type: 'contour', x: surfaceData.x, y: surfaceData.y, z: surfaceData.z, colorscale: 'Jet' }];
            
            Plotly.newPlot('plot', surfacePlot);
            Plotly.newPlot('contour', contourPlot);
        }

        updatePlot(); // Initial plot on page load
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
</body>
</html>
